---
title: "RestHabitsMD"
author: "Stella & Lauren"
date: "11/16/2021"
output: html_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### BEGIN PROJECT

**load packages**

```{r load packages}
library(tidyverse)
library(knitr)
library(ggmosaic)
```

**reading in data**

```{r read data}
rest_habits_raw <- readr::read_csv(here::here("data","412MockData.csv"))
```

### CLEAN DATA

**Goals:**

- delete the extra columns
- do we need to rename?
- check for missing/incorrect values (what do we do?)

Rundown of variables:

| Name (Rename)                  |  Description
|--------------------------------|--------------------------------
|`age` [convert to num]          | ages 18+
|`sex`                           | Male/Female/Other
|`race``                         | Race/ethnicity
|`year`                          | school year (1-4, 5+)
|`gpa_1` (gpa[convert to num])   | (should be in 0.00 format) (check?)

|`degree`                        | undergraduate/graduate/combined degree
|`undergrad`                     | 
|`grad`                          | 
|`combined`                      | 

|`sleepDuration`                 | duration slept each night
|`sleepEnough`                   | is sleepDuration enough? (Y/N)

|`regSleep`                      | do they have a regular sleep schedule? (Y/N)
|`sleepCatchUp`                  | "catch-up" on sleep? (Y/N)
|`allNighter`                    | pull all nighers?
|`dayTired`                      | feel tired during the day?

|`fallStayAsleep`                | have issues falling/staying asleep?
|`sleepDisorder`                 | previously diagnosed with a sleep disorder?

|`napFreq`                       | how frequently do they nap?
|`napDuration`                   | how long are the naps?

|`leisureTime`                   | have leisure time?
|`leisureFreq`                   | how much leisure time?

|`socialMedia`                   | do they use social media?
|`socMedDuration`                | how much time do they spend on social media?

|`academic_1` (academics)        | how do they feel they are doing academically?
|`mentalHealth_1` (energy)       | energy levels
|`mentalHealth_2` (stress)       | stress levels
|`mentalHealth_3` (concentration)| ability to concentrate
|`mentalHealth_4` (mood)         | overall mood
  
  
**TO DO** how to deal with undergrad? groups?


- delete unwanted cols/rows
  
```{r remove cols}
rest_habits <- rest_habits_raw %>% 
  select(age:`mentalHealth _4`)
```

**TO DO** remove blank observations?

- removed first row of questions

```{r remove first row}
rest_habits <- rest_habits [-c(1),]
```

- renaming

```{r rename}
rest_habits <- rest_habits %>% 
  rename(gpa=`gpa _1`,
         academics=`academic _1`,
         energy=`mentalHealth _1`,
         stress=`mentalHealth _2`,
         concentration=`mentalHealth _3`,
         mood=`mentalHealth _4`)
```

- convert age & gpa to numeric

```{r num gpa/age}
rest_habits$gpa <- as.numeric(rest_habits$gpa)
rest_habits$age <- as.numeric(rest_habits$age)
```

*writing out cleaned dataset for shiny app*

```{r}
readr::write_rds(rest_habits, here::here("RestHabits", "shinydata.rds"))
```

**TODO** if statements to sort majors? get rid of n/a's


```{r}
level_sleepDur = c('Less than 5 hours.', '5-6 hours.', '6-7 hours.', '7-8 hours.', '9-10 hours.', 'More than 10 hours.')
##across function
level_acad = c('Bad', 'Not Good', 'Ok', 'Good', 'Great')
```

```{r}
rest_habits %>% 
  mutate(sleepDuration = factor(sleepDuration, levels = level_sleepDur)) %>% 
  mutate(across(c(academics, concentration, mood, stress, energy), ~factor(., levels = level_acad)))
```



### MESSING WITH VISUALIZATIONS

```{r gpa histogram}
rest_habits %>% 
  ggplot() +
  geom_histogram(mapping = aes(x = gpa))
```

**TO DO** what vars do we want 4 realsies?

```{r contingency name?}
c_table <-
  rest_habits %>% 
  group_by(sex, sleepDisorder) %>% 
  tally() %>% 
  spread(key = sleepDisorder, value = n)

print.data.frame(c_table)
```

(trying contingency table but *kable*)

```{r contingency kable}
rest_habits %>%
  group_by(sex, sleepDisorder) %>%
  summarize(n=n()) %>%
  spread(sleepDisorder, n)%>%
  kable()
```


```{r mosaic}
rest_habits %>% 
  filter(!is.na(sleepDuration)) %>% 
  mutate(sleepDuration = factor(sleepDuration, levels = level_sleepDur)) %>% 
  ggplot() +
  geom_mosaic(aes(x=product(sleepDuration, degree), fill=sleepDuration)) +
  labs(y="Duration of sleep each night", x="Type of Degree", title="Mosaic Plot")
```

 - basic boxplot? even need or just stick to hist?

```{r boxplot gpa}
ggplot(rest_habits, aes(x=gpa)) + 
  geom_boxplot()
```


```{r piechart degree, eval = FALSE}
ggplot(rest_habits, aes(x="", y=degree, fill=degree)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  theme_void()
```


```{r piechart grad, eval = FALSE}
rest_habits %>% 
  filter(!is.na(grad)) %>% 
  ggplot(aes(x="", y=grad, fill=grad)) + 
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  theme_void()
```

(group undergrad majors by subject) **HOW**

```{r group undergrad majors}
## var %in% c("..", "..")

gradCat <- rest_habits %>%
  filter(!is.na(grad)) %>% 
  select(grad) %>% 
  add_column(category = NA)

gradCat %>% #do i have to write grad == every time
  mutate(category = case_when(
     grad == "Communications" ~ "busLeg", #Business & Legal
     grad == "" ~ "cultHum", #Cultures and Humanities
     grad == "" ~ "science", #Biological, Environmental, and Physical Sciences
     grad == "Education" || "Higher Education" ~ "education", #Education
     grad == "" ~ "art", #Fine Arts and Design
     grad == "Physician Assistant Studies" || "Medical Dosimetry" || "Public Health" || "Physical Therapy" ~ "health", #Health and Medicine
     grad == "Biostatistics" || "Data Science and Analytics" ~ "mathEng", #Math and Engineering
     grad == "Speech-Language Pathology" || "Social Work" ~ "socBehave")#Social and Behavioral Sciences)
  )

```
  

```{r bar chart degree}
ggplot(rest_habits, aes(x=degree)) + 
  geom_bar()
```

```{r bar chart concentration}
rest_habits %>% 
  mutate(concentration = factor(concentration, levels = level_acad)) %>% 
  ggplot(aes(x=concentration)) + 
  geom_bar() +
  coord_flip()
```

```{r average grad gpa)}
circle_grad <- rest_habits %>%
  filter(!is.na(gpa)) %>% 
  group_by(degree) %>% 
  summarise(
    avg_gpa = mean(gpa),
    num_resp = n()
  ) %>% 
  mutate(avg_gpa = round(avg_gpa, digits = 2),
         num_resp= round(num_resp, digits = 0))
```


```{r}
 rest_habits %>% 
            filter(!is.na(sleepDuration)) %>% 
            ggplot(aes(x = energy, fill = sleepDuration)) + 
            geom_bar(position = "dodge")
```




### QUESTIONS

- do particular degrees/majors sleep less than others?

- do those who sleep less have worse mental health/academics?

- do those who nap tend to have higher gpa/academic rating?

- do students think that the amount they sleep each night is enough?

- do students who pull all-nighters have a lower gpa/academics?

- which majors have less leisure time?

- leisure time vs. gpa?

- gpa vs. academics?

- no leisure time vs. time on social media?

- nap freq/duration vs. energy?



### SOURCES

contingency tables: https://community.rstudio.com/t/how-do-you-convert-a-tidy-data-frame-to-a-contingency-table/99562/2

http://analyticswithr.com/contingencytables.html

box plots: http://www.sthda.com/english/wiki/ggplot2-box-plot-quick-start-guide-r-software-and-data-visualization

bar charts: http://www.sthda.com/english/wiki/ggplot2-barplots-quick-start-guide-r-software-and-data-visualization

mosaic plots: https://cran.r-project.org/web/packages/ggmosaic/vignettes/ggmosaic.html

pie chart: https://www.r-graph-gallery.com/piechart-ggplot2.html

circular bar plot: https://www.r-graph-gallery.com/web-circular-barplot-with-R-and-ggplot2.html looks cool af

analysis? https://scc.ms.unimelb.edu.au/resources-list/simple-r-scripts-for-analysis/r-scripts

themes https://ggplot2.tidyverse.org/reference/ggtheme.html


### ideas for grouping

https://tme.uconn.edu/explore-majors/groups/


### random shit

- change outlier, color, shape, size

ggplot(rest_habits, aes(x=***, y=***)) +
  geom_boxplot(outlier.colour="red", outlier.shape=8, outlier.size=4)

- change box plot line colors by groups

p <- ggplot(rest_habits, aes(x=***, y=***, color=***)) +
  geom_boxplot()
  
- use custom color palettes

p+scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9"))

- boxplot

bp + scale_fill_brewer(palette="Dark2")

- Scatter plot

sp + scale_color_brewer(palette="Dark2")

data <- tibble (
  q1 = sample(n, c(...)) run simulations to make fake 
)

hello


- ordering of axis 
- grouping majors 

